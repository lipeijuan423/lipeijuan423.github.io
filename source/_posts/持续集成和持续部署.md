---
title: 持续集成和持续部署
date: 2019-07-11 15:47:50
tags:
---
### 基本流程： github - jenkins - 线上服务器
> github 设置git-hook提交触发
> jenkins 响应git-hook, 构建：成功->推送到线上服务器 ；失败->邮件通知
> 线上服务器 nginx 

## CI/CD
> 更大程度上实现应用开发的持续自动化和持续监控
### 项目到生产环境的整个流程
1. 提交 开发者向代码仓库提交
2. 测试（1） 代码仓库对commit配置了钩子函数，代码合入主干会跑自动化测试,至少跑单元测试
单元测试：针对函数或模块的测试
集成测试：针对整体产品的某个功能的测试，又称功能测试
端对端测试：从用户界面直达数据库的全链路测试
3. 构建
测试后可以合并到主干，交付---后先构建（将源码转为可以运行的代码，比如安装依赖，配置资源）
- 构建工具： Jenkins Travis codeship strider
4.测试（2）
全面测试（如果1做了，可以省略）
5.部署
当前代码是可以直接部署的版本，将所有文件打包存档，发送到生产服务器，生产服务器解包成本地目录，再运行路径的符号链接指向这个目录，重启应用
- 部署工具：ansible chef puppet
6.回滚： 最简单就是修改符号链接，指向上一个版本目录 
### CI - 持续集成 Continuous 
> 行为： 频繁地将代码集成到主干 
- 快速发现错误
- 防止分支大幅偏离主干
- 核心措施： 代码必须通过自动化测试，才能集成
- 步骤： 构建 - 单元测试 - 集成测试 （自动化流程）
> 目的： 让产品可以快速迭代，保持高质量代码

### CD
> 持续交付和持续部署可能会交叉使用，根据自动化的程度
#### CD - 持续交付 Continuous delivery
> 行为： 可自动将已验证的代码发布到存储库
> 目的:拥有一个可随时部署到生产环境的代码库
#### CD - 持续部署 continuous deployment
> 行为： 自动将应用发布到生产环境， 很大程度需要依赖测试自动化
### 对比
> 传统：
  - bug发现晚
  - 项目后期问题难解决
> 敏捷：
  - 减少分支，回归主干
  - 更快交付成果，更快修复问题
### 测试
> 为什么写测试
- 提高代码质量，减少维护成本，降低重构难度，对开发人员也会有加大工作量
> 测试写多细
- 逻辑复杂
- 容易出错
- 不易理解
- 公共代码
- 核心业务代码

> 单元测试
- 定义一个模块，函数，类进行正确性检验的测试工作
- 情况：
  - 测试驱动开发 TDD : 具体实现代码之前
  - 测试代码和功能代码同步进行
  - 功能完成再写单元测试 - 粒度比较粗
- 作用：
  - 高质量代码
  - 易于重构
  - 通过单元测试快速熟悉代码
> 集成测试
> 端对端测试
### 方案
- 链接
  - http://www.ruanyifeng.com/blog/2015/09/continuous-integration.html
  - https://blog.csdn.net/flysqrlboy/article/details/79301241